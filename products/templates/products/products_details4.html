
{% extends "products/base.html" %}
{% load thumbnail %}

{% load static %}

{% load i18n %}

{% block content %}

{% for product in products %}

{% for field in form %}
<center>
    <label class="col-4">{{ field.label}}</label>
    <ul>  <input id="123">  {{ field}} </ul>  
</center>
{% endfor %}

<button id="{{ field}}">press</button>
<script>
document.getElementById(" {{ field}}").addEventListener("click", () => {
  document.getElementById("123").focus();
});

</script>


<div class="container my-5">
    
    <div class="card">
        <div class="row">
            <aside class="col-sm-5   border-right">
    <article class="gallery-wrap"> 
    <div class="img-big-wrap">


        
     
     <a href="{% url 'mainapp:cart' product.slug %}">
        <img id="myimage"  {% thumbnail product.mainimage "350" as im %}
        <img align="center" src="{{ im.url }}"  class="img-fluid">
      {% endthumbnail %}  
      </div>
     
      </a>

      
     
   
        <tr> 
            <center>   <td><h3><p style="color:rgb(0, 0, 0)">{{product.calc}} руб. за {{product.tirazh}} шт.</p></h3></td>  </center> 
        </tr>
       
    
     </body>
    </html>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

  
  
  {% if request.user.is_authenticated %}

  
  <center>
       <span id="link"><a href="{% url 'mainapp:cart' product.slug %}" class="btn  btn-lg  btn-secondary text-uppercase"> <i class="fas fa-shopping-cart"></i> {% trans 'заказать' %}  </a></span> 
    </center>    
         {% else %}
        <!--    <h6 class="card-title"><span class="text-muted"><p style="color:rgb(229, 152, 147)">{% trans 'пожалуйста, зарегистрируйтесь,чтобы мы смогли оформить заказ' %}</p></span></a></h6> -->
        
        <center>
            <p><a style="color:rgb(229, 152, 147)" href="/register.html"> <p style="color:rgb(0, 0, 0)"> {% trans 'зарегистрироваться ' %}</p></span></a></h6> 
             {% endif %}
            </center> 

      
      </body> 

<!-- перезагрузка страницы по времени


<script>

reloader = setTimeout(reload, 10000);
function reload(){
     window.location.reload();
//      window.location.replace(url);  -  редирект на любую другую страницу
};

$('body').on('action','element',function(){
      clearTimeout(reloader);  // очищаем таймаут и тем самым начинаем отсчет 5 секунд
});
   
</script> -->
    <!-- slider-product.// -->
    </article> <!-- gallery-wrap .end// -->
            </aside>
            <aside class="col-sm-7">
    <article class="card-body p-5">
  
  
        
        <td>
        <td>{{object.tirazh}}</td>
        
    </td>
    
    
    <!-- 
        <span class="price h3 text-warning">  
       <span class="num">₽<span<p id="result"><p>  </span> 
        <span class="num">₽<span<p>{{product.calc}}</p>  </span>
           
      -->         
        </span> 
        
    </td>   
<ul>
  <!-- <span class="price h3 text-warning">  --> 
  <center> <h3 class="title mb-3"> {{ product.name }}</h3></center> 

</ul>

<!--

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Тег FONT</title>
 </head>
 <body>
  <center> <p><font size="15" color="gray" face="Brush Script MT">Экспертная полиграфия</font> </p></center> 
 <center> <p><font size="4" color="gray" face="Good Vibes Pro ">{{product.detail_text }}</font> </p></center>
 </body>
</html>
-->

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://bootstrap-4.ru/docs/5.2/assets/css/docs.css" rel="stylesheet">
    <title>Bootstrap Example</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body class="p-3 m-0 border-0 bd-example">

    <!-- Example Code -->
    
    <p>
    <center>
      <button class="btn btn-outline-secondary collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
          техническое характеристики изделия
      </button> </center>
    </p>
    <div class="collapse" id="collapseExample" style="">
      <div class="card card-body">
{{product.detail_text }}
      </div>
    </div>
    
    
  </body>
</html>

 <!--
<ul>
    <div onmouseover="this.style.color='black';" onmouseout="this.style.color='black';">{{product.detail_text }}</div>
 
</ul> -->

<p id="demo"></p>

<script>
a = {{product.lim1}} 
b = {{product.boxsize.b}}
h = {{boxsize.minprice}
d = {{product.boxsize.d}} 

document.getElementById("demo").innerHTML = a;
</script>
 <!--
<center>

<p style="color:rgb(0, 0, 0
)">  {% trans 'мин.тираж' %}- {{product.lim1}} {% trans 'шт.' %}.(<span class="price-new">{{product.maxprice}} ₽/шт.);<p>{% trans 'мaкс.тираж' %}- {{product.lim2}} шт. ({{product.minprice}} ₽/шт.)</span></p></td>
</center> -->

   <!-- <h6 class="title mb-3">{{product.detail_text }}</h3> -->
<div class="container-fluid">
    <form id="product-form">
        <div class="row">
            {% csrf_token %}
            <div class="form-group col-11">





                <!--всплывающая подсказка-->


              <script>
                $(function () {
                  $('[data-toggle="tooltip"]').tooltip()
                })
                </script>
              
       
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
<p style="margin:40px;"> <a target="_blank" 
  data-toggle="tooltip" 
  data-placement="right" title='минимальный тираж - {{product.lim1}} шт. цена: {{product.maxprice}} ₽/шт. максим. тираж - {{product.lim2}} шт., цена: {{product.minprice}} ₽/шт.'   ; <p> 

   
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script>
$(function () {
  $('[data-toggle="tooltip"]').tooltip()
})
</script> 

              
            {% for field in form %}
            <center>
                <label class="col-4">{{ field.label }}</label>
                
          
          <ul>   {{ field }}   </ul>  
        </center>
            {% endfor %}
      
            
<!--

            <div style="position:absolute;z-index:10000;top:500 px;margin-left: 500 px;">
                <br>
                <h4> </h4><input type="submit" class= "btn btn-secondary btn-buy" value="Рассчитать" />
                <p style="color:rgb(229, 152, 147)"></p><input type="submit" class= "btn btn-success btn-buy" value=Расчитать style="color:rgb(229, 152, 147)"-->
            
            </div>
            
            <input type="hidden" id="custId" name="product_id" value="{{ product.id }}">
            
        </div> 


        


      <!--  
  <center>
    <span id="link"><a class="btn  btn-lg  btn-outline-secondary text-uppercase"> <i class="fas fa-shopping-cart"></i> заказать </a></span> 
 </center> 
--> 
        <center>

            <input type="submit"  class="btn btn-lg btn-outline-secondary btn-buy"  value="ПОСЧИТАТЬ СТОИМОСТЬ ТИРАЖА" 
            
            <center>

                <br><br>

               
               
 <!-- флип-флоп

    

         <p><a style="color:rgb(229, 152, 147)" href="javascript:flipflop('animals');">{% trans 'у вас выводится иное от введенного значение тиража?' %}</a></p>             

         
<ul id="animals" style="display: none;">

    <li><div id="browse_app">
</li> 

<li><div id="browse_app">

  в случае, если вы ввели число не попадающие в диапазон между минимальным и макисмальным тиражом,
    рассчет будет произведен по одной из границ.Алгоритм ориентируется на min или max тиражи, 
    то есть автоматически увеличивает тираж до минимального, или считает не больше максимального.

</li>


  
</div>   --> 

</hr>
</ul>
<html>
  
   <head>

   
   
  
    <div class="container-fluid">
        <table class="table table-striped table-sm" id="my_products">  
            <thead>
                <tr>
                    <th>{% trans 'Размер' %} </th>
                    <th>{% trans 'Дата изготовления' %} </th>
                    <th>{% trans 'Тираж(шт.)' %}</th>
                    <th>{% trans 'Цена(руб.)' %}</th>
                    
                    
                </tr>
            </thead>
            <tbody>



    <!--
              
    
            
            <tr>
                <td><p style="color:rgb(229, 152, 147)">{{product.box_size}}</p></td>
                <td><p style="color:rgb(229, 152, 147)">{{product.timeplus}}</p></td>
                <td><p style="color:rgb(229, 152, 147)">{{product.tirazh}}</p></td>
                <td><p style="color:rgb(229, 152, 147)">{{product.calc}}</p></td>
            
    
            </tr>   -->

    
            <tr>

                <td><p  style="color:rgb(0, 0, 0)">{{product.box_size}}</p></td>
                <td><p  style="color:rgb(0, 0, 0)">{{product.timeplus}}</p></td>
                <td><p style="color:rgb(0, 0, 0)">{{product.tirazh}}</p></td>
                <td><p style="color:rgb(0, 0, 0)">{{product.calc}}</p></td>
            

            </tr>
    
            
    
            </tbody>
  <!--     </table>   --> 

        
     
  <!-- </div> --> 


    
      <script language="JavaScript">
       

         // Показывает скрытое, скрывает видимое
         function flipflop( id )
         {

          // id -- идентификатор элемента, который надо скрыть или показать

          // получаем этот элемент
          element = document.getElementById( id );

          // если таковой в документе существует
          if( element )   
             // меняем ему видимость
             element.style.display = element.style.display == "none" ? "" : "none";   
         }
       
      </script>

   </head>

   <body>

      <ul>

       

        

           
           
           <!--
        
         <p><a href="javascript:flipflop('animals');">{% trans 'у вас исчезает введенное значение тиража?' %}</a></p> 
         
            <ul id="animals" style="display: none;">
              <li><div id="browse_app">

                {% trans ' значение тиража не слетает, результат выводится на экран  в строке  зеленым цветом, а поле ввода обнуляется для следующего расчёта' %}
               
       
         </li>

          </ul>


    

            <li>
   
               <p><a href="javascript:flipflop('an');"><p style="color:rgb(36, 163, 60)"></p>  {% trans 'вы вводите один тираж, а на экране выводится другой?' %} </a></p> 
              
               <ul id="an" style="display: none;">
                 <li><div id="browse_app">

                    
                    {% trans 'Всё нормально, алгоритм ориентируется на min или max тиражи, то есть автоматически увеличивает тираж до минимального, или считает не больше максимального ' %}
                  
          
            </li>
   
             </ul>

         
         -->

   </body>

</html>



  
       {% endfor %}
        </tbody>
    </table>

</div>
{% endblock content %}


{% block javascript %}
<script>

    $(document).ready(function() {
        /*
            On submiting the form, send the POST ajax
            request to server and after successfull submission
            display the object.
        */
        $("#product-form").submit(function (e) {
            // preventing from page reload and default actions
           
            // serialize the data for sending the form data.
            var serializedData = $(this).serialize();
            // make POST ajax call
            $.ajax({
                // POST метод
                type: 'POST',
                url: "{% url 'post_product' %}",
                data: serializedData,
                // async: true,

                timeout:20000,

                // Функция вызываемая если запрос успешен
                success: function (response) {
                    // on successfull creating object
                    // 1. clear the form.
                    $("#product-form").trigger('reset');
                    // 2. focus to nickname input 
                    // $("#id_product.name").focus();

                    // display the newly friend to table.
                    var instance = JSON.parse(response["instance"]);
                    var fields = instance[0]["fields"];

                    // $("#my_friends tbody").empty()

                    $("#my_products tbody").prepend(
                        `<tr>
                        <td>${fields["box_size"]||""}</td>
                        <td>${fields["tirazh"]||""}</td>
                        
                        </tr>`
                    )

                    // $("#my_products tbody").html(
                    //     `<tr>
                    //     <td>${fields["box_size"]||""}</td>
                    //     <td>${fields["tirazh"]||""}</td>
                        
                    //     </tr>`
                    // )
                },
                // error вызывается, если запрос выполняется с ошибкой
                error: function (response) {
                    // alert the error if any error occured
                    // alert('EERRRRRRRRRRRRRRRRRRRRRRRRRRR')
                    alert(response["responseJSON"]["error"]);
                },
                complete: function (response) {
                    // alert('OOOOOOOOOKKKKKKK');
                    location.reload();
                }
            })
        })

        // <td>${fields["price"]||""}</td>

        /*
        On focus out on input nickname,
        call AJAX get request to check if the nickName
        already exists or not.
        */
        $("#id_nick_name").focusout(function (e) {
            e.preventDefault();
            // get the nickname
            var nick_name = $(this).val();
            // GET AJAX request
            $.ajax({
                type: 'GET',
                url: "{% url 'validate_nickname' %}",
                data: {"nick_name": nick_name},
                success: function (response) {
                    // if not valid user, alert the user
                    if(!response["valid"]){
                        alert("You cannot create a friend with same nick name");
                        var nickName = $("#id_nick_name");
                        nickName.val("")
                        nickName.focus()
                    }
                },
                error: function (response) {
                    console.log(response)
                }
            })
        })
    })
</script>
{% endblock javascript %}








<p id="result"></p>
<script>                
 {
    
    
    var x = {{product.tirazh}} ;
    if (x < 1000) {
    x = 1000;
    }
    var num= {{product.calc}} 
    var r = (Math.floor(num * 1) / 1) // первая часть искомого числа
    var ost = num - r
    var r1 = r * 0.0001 // первая часть искомого числа, с учетом знаков после запятой
    var st = x ** (ost*(-1)) // тираж в искомой степени
    var e = (r1 * st)
    var y = Math.round(e)
    var res = e*x; }
    document.getElementById("result").innerHTML = res;
</script> 


