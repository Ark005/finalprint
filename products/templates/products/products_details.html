
{% extends "products/base.html" %}
{% load thumbnail %}

{% load static %}

{% load i18n %}

{% block content %}

{% for product in products %}











<div class="container my-5">
    
    <div class="card">
        <div class="row">
            <aside class="col-sm-5 border-right">
    <article class="gallery-wrap"> 
    <div class="img-big-wrap">
       <!--
        {% thumbnail product.mainimage "350" as im %}
        <img align="center" src="{{ im.url }}"  class="img-fluid">
    {% endthumbnail %}
 -->

<!--

 <!DOCTYPE html>
 <html>
 <head>
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <style>
 * {box-sizing: border-box;}
 
 .img-zoom-container {
   position: relative;
 }
 
 .img-zoom-lens {
   position: absolute;
   border: 1px solid #d4d4d4;
   /*установите размер объектива:*/
   width: 40px;
   height: 40px;
 }
 
 .img-zoom-result {
   border: 1px solid #d4d4d4;
   /*установите размер результата div:*/
   width: 300px;
   height: 300px;
 }
 </style>
 <script>
 function imageZoom(imgID, resultID) {
   var img, lens, result, cx, cy;
   img = document.getElementById(imgID);
   result = document.getElementById(resultID);
   /*создать линзу:*/
   lens = document.createElement("DIV");
   lens.setAttribute("class", "img-zoom-lens");
   /*вставить линзы:*/
   img.parentElement.insertBefore(lens, img);
   /*вычислите соотношение между результатом DIV и объективом:*/
   cx = result.offsetWidth / lens.offsetWidth;
   cy = result.offsetHeight / lens.offsetHeight;
   /*задайте свойства фона для результата DIV:*/
   result.style.backgroundImage = "url('" + img.src + "')";
   result.style.backgroundSize = (img.width * cx) + "px " + (img.height * cy) + "px";
   /*выполните функцию, когда кто-то перемещает курсор на изображение или объектив:*/
   lens.addEventListener("mousemove", moveLens);
   img.addEventListener("mousemove", moveLens);
   /*а также для сенсорных экранов:*/
   lens.addEventListener("touchmove", moveLens);
   img.addEventListener("touchmove", moveLens);
   function moveLens(e) {
     var pos, x, y;
     /*предотвратите любые другие действия, которые могут произойти при перемещении по изображению:*/
     e.preventDefault();
     /*получить позиции курсора x и y:*/
     pos = getCursorPos(e);
     /*рассчитайте положение объектива:*/
     x = pos.x - (lens.offsetWidth / 2);
     y = pos.y - (lens.offsetHeight / 2);
     /*не допускайте расположения объектива вне изображения:*/
     if (x > img.width - lens.offsetWidth) {x = img.width - lens.offsetWidth;}
     if (x < 0) {x = 0;}
     if (y > img.height - lens.offsetHeight) {y = img.height - lens.offsetHeight;}
     if (y < 0) {y = 0;}
     /*установите положение объектива:*/
     lens.style.left = x + "px";
     lens.style.top = y + "px";
     /*покажите что такое объектив:*/
     result.style.backgroundPosition = "-" + (x * cx) + "px -" + (y * cy) + "px";
   }
   function getCursorPos(e) {
     var a, x = 0, y = 0;
     e = e || window.event;
     /*получить x и y позиции изображения:*/
     a = img.getBoundingClientRect();
     /*вычислите координаты курсора x и y относительно изображения:*/
     x = e.pageX - a.left;
     y = e.pageY - a.top;
     /*рассмотрим любую прокрутку страницы:*/
     x = x - window.pageXOffset;
     y = y - window.pageYOffset;
     return {x : x, y : y};
   }
 }
 </script>
 </head>
 <body>
 
 
 

 
 
 <script>
 // Инициировать эффект масштабирования:
 imageZoom("myimage", "myresult");
 </script>
 
 </body>
 </html>

-->
<!--
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* {box-sizing: border-box;}

.img-magnifier-container {
  position:relative;
}

.img-magnifier-glass {
  position: absolute;
  border: 3px solid #000;
  border-radius: 50%;
  cursor: none;
  /*Установите размер увеличительного стекла:*/
  width: 100px;
  height: 100px;
}
</style>
<script>
function magnify(imgID, zoom) {
  var img, glass, w, h, bw;
  img = document.getElementById(imgID);
  /*создать увеличительное стекло:*/
  glass = document.createElement("DIV");
  glass.setAttribute("class", "img-magnifier-glass");
  /*вставить увеличительное стекло:*/
  img.parentElement.insertBefore(glass, img);
  /*установите свойства фона для увеличительного стекла:*/
  glass.style.backgroundImage = "url('" + img.src + "')";
  glass.style.backgroundRepeat = "no-repeat";
  glass.style.backgroundSize = (img.width * zoom) + "px " + (img.height * zoom) + "px";
  bw = 3;
  w = glass.offsetWidth / 2;
  h = glass.offsetHeight / 2;
  /*выполните функцию, когда кто-то перемещает лупу по изображению:*/
  glass.addEventListener("mousemove", moveMagnifier);
  img.addEventListener("mousemove", moveMagnifier);
  /*а также для сенсорных экранов:*/
  glass.addEventListener("touchmove", moveMagnifier);
  img.addEventListener("touchmove", moveMagnifier);
  function moveMagnifier(e) {
    var pos, x, y;
    /*предотвратите любые другие действия, которые могут произойти при перемещении по изображению*/
    e.preventDefault();
    /*получить позиции курсора x и y:*/
    pos = getCursorPos(e);
    x = pos.x;
    y = pos.y;
    /*не допускайте размещения увеличительного стекла вне изображения:*/
    if (x > img.width - (w / zoom)) {x = img.width - (w / zoom);}
    if (x < w / zoom) {x = w / zoom;}
    if (y > img.height - (h / zoom)) {y = img.height - (h / zoom);}
    if (y < h / zoom) {y = h / zoom;}
    /*установите положение увеличительного стекла:*/
    glass.style.left = (x - w) + "px";
    glass.style.top = (y - h) + "px";
    /*покажите что такое лупа:*/
    glass.style.backgroundPosition = "-" + ((x * zoom) - w + bw) + "px -" + ((y * zoom) - h + bw) + "px";
  }
  function getCursorPos(e) {
    var a, x = 0, y = 0;
    e = e || window.event;
    /*получить x и y позиции изображения:*/
    a = img.getBoundingClientRect();
    /*вычислите координаты курсора x и y относительно изображения:*/
    x = e.pageX - a.left;
    y = e.pageY - a.top;
    /*рассмотрим любую прокрутку страницы:*/
    x = x - window.pageXOffset;
    y = y - window.pageYOffset;
    return {x : x, y : y};
  }
}
</script>
</head>
<body>




<div class="img-magnifier-container">
  <img id="myimage"  {% thumbnail product.mainimage "350" as im %}
  <img align="center" src="{{ im.url }}"  class="img-fluid">
{% endthumbnail %}  
</div>



<script>
/* Инициировать функцию увеличения
   с идентификатором изображения и силой увеличительного стекла:*/
magnify("myimage", 3);
</script>

</body>
</html>


-->

    <!DOCTYPE html>
    <html>
     <head>
      <meta charset="utf-8">
      <title>Увеличение изображения</title>
      <style>
       .scale {
        display: inline-block; /* Строчно-блочный элемент */
        overflow: hidden; /* Скрываем всё за контуром */
       }
       .scale img {
        transition: 1s; /* Время эффекта */
        display: block; /* Убираем небольшой отступ снизу */
       }
       .scale img:hover {
        transform: scale(1.4); /* Увеличиваем масштаб */
       }
      </style>
     </head>
     <body>

       
     <!-- <div class="scale"> <img src="/media/products/test9.png"  alt="" class="scale"></div> -->
      <div class="scale">  {% thumbnail product.mainimage "350" as im %}
        <img align="center" src="{{ im.url }}"  class="img-fluid">
   
        <tr> 
            <center>   <td><h3><p style="color:rgb(0, 0, 0)">{{product.calc}} руб. за {{product.tirazh}} шт.</p></h3></td>  </center> 
        </tr>
   

    {% endthumbnail %} </div>
     </body>
    </html>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

    {% if request.user.is_authenticated %}

    
  <center>
       <span id="link"><a href="{% url 'mainapp:cart' product.slug %}" class="btn  btn-lg  btn-secondary text-uppercase"> <i class="fas fa-shopping-cart"></i> {% trans 'заказать' %}  </a></span> 
    </center>    
         {% else %}
        <!--    <h6 class="card-title"><span class="text-muted"><p style="color:rgb(229, 152, 147)">{% trans 'пожалуйста, зарегистрируйтесь,чтобы мы смогли оформить заказ' %}</p></span></a></h6> -->
        
        <center>
            <p><a style="color:rgb(229, 152, 147)" href="/register.html"> <p style="color:rgb(0, 0, 0)"> {% trans 'зарегистрироваться и оформить заказ' %}</p></span></a></h6> 
             {% endif %}
            </center> 

      
      </body> 



      

    <!-- slider-product.// -->
    </article> <!-- gallery-wrap .end// -->
            </aside>
            <aside class="col-sm-7">
    <article class="card-body p-5">
  
  
        
        <td>
        <td>{{object.tirazh}}</td>
        
    </td>
    
    
    <!-- 
        <span class="price h3 text-warning">  
       <span class="num">₽<span<p id="result"><p>  </span> 
        <span class="num">₽<span<p>{{product.calc}}</p>  </span>
           
      -->         
        </span> 
        
    </td>   
<ul>
  <!-- <span class="price h3 text-warning">  --> 
  <center> <h3 class="title mb-3"> {{ product.name }}</h3></center> 

</ul>

<!--

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Тег FONT</title>
 </head>
 <body>
  <center> <p><font size="15" color="gray" face="Brush Script MT">Экспертная полиграфия</font> </p></center> 
 <center> <p><font size="4" color="gray" face="Good Vibes Pro ">{{product.detail_text }}</font> </p></center>
 </body>
</html>
-->

<ul>
    <div onmouseover="this.style.color='black';" onmouseout="this.style.color='black';">{{product.detail_text }}</div>
 
</ul> 

<p id="demo"></p>

<script>
a = {{product.lim1}} 
b = {{product.boxsize.b}}
h = {{boxsize.minprice}
d = {{product.boxsize.d}} 

document.getElementById("demo").innerHTML = a;
</script>

<center>

<p style="color:rgb(0, 0, 0
)">  {% trans 'мин.тираж' %}- {{product.lim1}} {% trans 'шт.' %}.(<span class="price-new">{{product.maxprice}} ₽/шт.);<p>{% trans 'мaкс.тираж' %}- {{product.lim2}} шт. ({{product.minprice}} ₽/шт.)</span></p></td>
</center>

   <!-- <h6 class="title mb-3">{{product.detail_text }}</h3> -->
<div class="container-fluid">
    <form id="product-form">
        <div class="row">
            {% csrf_token %}
            <div class="form-group col-11">
              
            {% for field in form %}
            <center>
                <label class="col-4">{{ field.label }}</label>
          
          <ul>   {{ field }}   </ul>  
        </center>
            {% endfor %}
      
           
<!--

            <div style="position:absolute;z-index:10000;top:500 px;margin-left: 500 px;">
                <br>
                <h4> </h4><input type="submit" class= "btn btn-secondary btn-buy" value="Рассчитать" />
                <p style="color:rgb(229, 152, 147)"></p><input type="submit" class= "btn btn-success btn-buy" value=Расчитать style="color:rgb(229, 152, 147)"-->
            
            </div>
            
            <input type="hidden" id="custId" name="product_id" value="{{ product.id }}">
            
        </div> 

      <!--  
  <center>
    <span id="link"><a class="btn  btn-lg  btn-outline-secondary text-uppercase"> <i class="fas fa-shopping-cart"></i> заказать </a></span> 
 </center> 
--> 
        <center>

            <input type="submit"  class="btn btn-lg btn-outline-secondary btn-buy"  value="ПОСЧИТАТЬ СТОИМОСТЬ ТИРАЖА" 
            
            <center>

                <br><br>


    

         <p><a style="color:rgb(229, 152, 147)" href="javascript:flipflop('animals');">{% trans 'у вас выводится иное от введенного значение тиража?' %}</a></p>             

         
<ul id="animals" style="display: none;">
 
 <!--
    <li><div id="browse_app">
</li> -->

<li><div id="browse_app">

  в случае, если вы ввели число не попадающие в диапазон между минимальным и макисмальным тиражом,
    рассчет будет произведен по одной из границ.Алгоритм ориентируется на min или max тиражи, 
    то есть автоматически увеличивает тираж до минимального, или считает не больше максимального.

</li>
  
<!--</div>  подчеркивание на всю страницу --> 

<hr />

 

</ul>
<html>
  
   <head>

   
   
  
    <div class="container-fluid">
        <table class="table table-striped table-sm" id="my_products">  
            <thead>
                <tr>
                    <th>{% trans 'Размер' %} </th>
                    <th>{% trans 'Дата изготовления' %} </th>
                    <th>{% trans 'Тираж(шт.)' %}</th>
                    <th>{% trans 'Цена(руб.)' %}</th>
                    
                    
                </tr>
            </thead>
            <tbody>



    <!--
              
    
            
            <tr>
                <td><p style="color:rgb(229, 152, 147)">{{product.box_size}}</p></td>
                <td><p style="color:rgb(229, 152, 147)">{{product.timeplus}}</p></td>
                <td><p style="color:rgb(229, 152, 147)">{{product.tirazh}}</p></td>
                <td><p style="color:rgb(229, 152, 147)">{{product.calc}}</p></td>
            
    
            </tr>   -->

    
            <tr>

                <td><p  style="color:rgb(0, 0, 0)">{{product.box_size}}</p></td>
                <td><p  style="color:rgb(0, 0, 0)">{{product.timeplus}}</p></td>
                <td><p style="color:rgb(0, 0, 0)">{{product.tirazh}}</p></td>
                <td><p style="color:rgb(0, 0, 0)">{{product.calc}}</p></td>
            

            </tr>
    
            
    
            </tbody>
  <!--     </table>   --> 

        
     
  <!-- </div> --> 


    
      <script language="JavaScript">
       

         // Показывает скрытое, скрывает видимое
         function flipflop( id )
         {

          // id -- идентификатор элемента, который надо скрыть или показать

          // получаем этот элемент
          element = document.getElementById( id );

          // если таковой в документе существует
          if( element )   
             // меняем ему видимость
             element.style.display = element.style.display == "none" ? "" : "none";   
         }
       
      </script>

   </head>

   <body>

      <ul>

       

        

           
           
           <!--
        
         <p><a href="javascript:flipflop('animals');">{% trans 'у вас исчезает введенное значение тиража?' %}</a></p> 
         
            <ul id="animals" style="display: none;">
              <li><div id="browse_app">

                {% trans ' значение тиража не слетает, результат выводится на экран  в строке  зеленым цветом, а поле ввода обнуляется для следующего расчёта' %}
               
       
         </li>

          </ul>


    

            <li>
   
               <p><a href="javascript:flipflop('an');"><p style="color:rgb(36, 163, 60)"></p>  {% trans 'вы вводите один тираж, а на экране выводится другой?' %} </a></p> 
              
               <ul id="an" style="display: none;">
                 <li><div id="browse_app">

                    
                    {% trans 'Всё нормально, алгоритм ориентируется на min или max тиражи, то есть автоматически увеличивает тираж до минимального, или считает не больше максимального ' %}
                  
          
            </li>
   
             </ul>

         
         -->

   </body>

</html>



  
       {% endfor %}
        </tbody>
    </table>

</div>
{% endblock content %}


{% block javascript %}
<script>

    $(document).ready(function() {
        /*
            On submiting the form, send the POST ajax
            request to server and after successfull submission
            display the object.
        */
        $("#product-form").submit(function (e) {
            // preventing from page reload and default actions
           
            // serialize the data for sending the form data.
            var serializedData = $(this).serialize();
            // make POST ajax call
            $.ajax({
                // POST метод
                type: 'POST',
                url: "{% url 'post_product' %}",
                data: serializedData,
                // async: true,

                timeout:20000,

                // Функция вызываемая если запрос успешен
                success: function (response) {
                    // on successfull creating object
                    // 1. clear the form.
                    $("#product-form").trigger('reset');
                    // 2. focus to nickname input 
                    // $("#id_product.name").focus();

                    // display the newly friend to table.
                    var instance = JSON.parse(response["instance"]);
                    var fields = instance[0]["fields"];

                    // $("#my_friends tbody").empty()

                    $("#my_products tbody").prepend(
                        `<tr>
                        <td>${fields["box_size"]||""}</td>
                        <td>${fields["tirazh"]||""}</td>
                        
                        </tr>`
                    )

                    // $("#my_products tbody").html(
                    //     `<tr>
                    //     <td>${fields["box_size"]||""}</td>
                    //     <td>${fields["tirazh"]||""}</td>
                        
                    //     </tr>`
                    // )
                },
                // error вызывается, если запрос выполняется с ошибкой
                error: function (response) {
                    // alert the error if any error occured
                    // alert('EERRRRRRRRRRRRRRRRRRRRRRRRRRR')
                    alert(response["responseJSON"]["error"]);
                },
                complete: function (response) {
                    // alert('OOOOOOOOOKKKKKKK');
                    location.reload();
                }
            })
        })

        // <td>${fields["price"]||""}</td>

        /*
        On focus out on input nickname,
        call AJAX get request to check if the nickName
        already exists or not.
        */
        $("#id_nick_name").focusout(function (e) {
            e.preventDefault();
            // get the nickname
            var nick_name = $(this).val();
            // GET AJAX request
            $.ajax({
                type: 'GET',
                url: "{% url 'validate_nickname' %}",
                data: {"nick_name": nick_name},
                success: function (response) {
                    // if not valid user, alert the user
                    if(!response["valid"]){
                        alert("You cannot create a friend with same nick name");
                        var nickName = $("#id_nick_name");
                        nickName.val("")
                        nickName.focus()
                    }
                },
                error: function (response) {
                    console.log(response)
                }
            })
        })
    })
</script>
{% endblock javascript %}








<p id="result"></p>
<script>                
 {
    
    
    var x = {{product.tirazh}} ;
    if (x < 1000) {
    x = 1000;
    }
    var num= {{product.calc}} 
    var r = (Math.floor(num * 1) / 1) // первая часть искомого числа
    var ost = num - r
    var r1 = r * 0.0001 // первая часть искомого числа, с учетом знаков после запятой
    var st = x ** (ost*(-1)) // тираж в искомой степени
    var e = (r1 * st)
    var y = Math.round(e)
    var res = e*x; }
    document.getElementById("result").innerHTML = res;
</script> 


